# 상태 패턴

## 의도

객체의 내부 상태가 변경될 때 해당 객체가 그의 행동을 변경할 수 있도록 하는 행동 디자인 패턴

이 패턴의 주요 개념은 모든 주어진 순간에 프로그램이 속해 있을 수 있는 상태들의 수는 유한하다는 것.

### 전이 (transition)

- 어떤 고유한 상태 내에서든 프로그램은 다르게 행동, 한 상태에서 다른 상태로 즉시 전환될 수 있음
- 하지만 현재 상태에 따라 프로그램은 특정 다른 상태로 전환되거나 전횐되지 않을 수 있음.

## 구조

1. 컨텍스트는 구상 상태 객체 중 하나에 대한 참조를 저장하고 모든 상태별 작업을 그곳에 위임한다. 컨텍스트는 상태 인터페이스를 통해 상태 객체와 통신하며, 새로운 상태 객체를 전달하기 위한 세터를 노출한다.

2. 상태 인터페이스는 상태별 메서드들을 선언한다. 이러한 메서드들은 모든 구상 상태에서 유효해야 한다. 왜냐하면 결코 호출될 일이 없는 쓸모없는 메서드들이 일부 상태 내에 존재하는 것은 원하지 않을 것이기 때문이다.

3. 구상 상태들은 상태별 메서드들에 대한 자체적인 구현을 제공한다. 여러 상태에서 유사한 코드의 중복을 피하기 위해 어떤 공통 행동을 캡슐화하는 중간 추상 클래스들을 제공할 수 있다. 상태 객체들은 컨텍스트 객체에 대한 역참조를 저장할 수 있다. 이 참조를 통해 상태는 컨텍스트 객체에서 모든 필요한 정보를 가져올 수 있고 상태 전이를 시작할 수 있다.

4. 컨텍스트와 구상 상태들 모두 컨텍스트의 다음 상태를 설정할 수 있으며, 컨텍스트에 연결된 상태 객체를 교체하여 실제 상태 전이를 수행할 수 있다.

## 적용

### 상태 패턴은 현재 상태에 따라 다르게 행동하는 객체가 있을 때, 상태들의 수가 많을 때, 상태별 코드가 자주 변경될 때 사용한다

이 패턴은 모든 상태별 코드를 서로 다른 클래스들의 집합으로 추출하도록 제안한다. 그렇게 하면 새로운 상태들을 추가하거나 기존 상태들을 서로 독립적으로 변경할 수 있어서 유지 관리 비용을 절감할 수 있다.

### 이 패턴은 클래스 필드들의 현재 값들에 따라 클래스가 행동하는 방식을 변경하는 거대한 조건문들로 오염된 클래스가 있을 때 사용한다

상태 패턴은 이러한 조건문들의 브랜치들을 해당 상태 클래스들의 메서드들로 추출할 수 있도록 한다. 이를 통해 주 클래스의 상태별 코드와 관련된 임시 필드들과 도우미 메서드들을 정리할 수 있다.

### 상태 패턴은 유사한 상태들에 중복 코드와 조건문 기반 상태 머신의 전이가 많을 때 사용한다

상태 패턴은 상태 클래스들의 계층 구조들을 구성할 수 있도록 하며 공통 코드를 추상 기초 클래스들에 추출하여 중복을 줄일 수 있다.
